#!/bin/bash

cd /bogo/gping

# note: ./www is sym linked to /var/www/html/gping (aka http://syswatch.science.mq.edu.au/gping/)

WEB=www
INCLUDE=$WEB/include.html
TIMESTAMP=$WEB/timestamp.html

source ~bogo/conda-setup.sh
conda activate gping
cat ip4 |		# pre-filtered
python gping.py |
sort |
awk -F, '
  BEGIN { colour["True"]="green"; colour["False"] = "red"; } 
        { print "<div id=\"" $1 "\" class=\"indicator " colour[$2] "\"><span class=\"tooltiptext\">" $1 "<br>" "VM_name" "</span></div>"}
' > $INCLUDE
chmod a+r $INCLUDE

date > $TIMESTAMP
